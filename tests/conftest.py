import datetime
import logging
from typing import Any

import ib_insync as ibi
import pytest
from ib_insync import Contract, ContractDetails

from haymaker.base import Atom as BaseAtom
from haymaker.controller import Controller
from haymaker.saver import AbstractBaseSaver
from haymaker.state_machine import StateMachine
from haymaker.streamers import Streamer as ActualStreamer
from haymaker.trader import Trader

log = logging.getLogger(__name__)


class FakeMongoSaver(AbstractBaseSaver):
    """
    It's a mock saver for testing that doesn't save to external media.

    :attr:`.store` has all the data that would have been saved.
    """

    store: dict[str, dict | list[dict]] = {}

    def __init__(self, collection: str, query_key: str | None = None) -> None:

        self.collection = collection
        self.query_key = query_key

        if self.query_key:
            self.store[self.collection] = {}
        else:
            self.store[self.collection] = []

    def save(self, data: dict[str, Any], /, *args: str) -> None:
        try:
            if self.query_key:
                key = data.get(self.query_key)
                self.store[self.collection][key] = data  # type: ignore
            elif not all(data.keys()):
                log.error(f"Attempt to save with wrong keys: {list(data.keys())}")
            else:
                self.store[self.collection].append(data)  # type: ignore
        except Exception:
            log.exception(Exception)
            log.debug(f"Data that caused error: {data}")
            raise

    def read(self, key: dict | None = None, /, *args) -> list:
        s = self.store[self.collection]
        if key:
            try:
                return [s.get(key)]  # type: ignore
            except AttributeError:
                return s  # type: ignore
        else:
            return s  # type: ignore


class FakeMongoLatestSaver(FakeMongoSaver):
    def read(self, *args):
        s = self.store[self.collection]
        try:
            return s[s.keys()[-1]]  # type: ignore
        except AttributeError:
            return s[-1]


@pytest.fixture
def order_saver():
    return FakeMongoSaver("orders", query_key="orderId")


@pytest.fixture
def strategy_saver():
    return FakeMongoLatestSaver("models")


@pytest.fixture
def state_machine(order_saver, strategy_saver):
    sm = StateMachine(
        order_saver=order_saver, strategy_saver=strategy_saver, save_async=False
    )
    yield sm
    # ensure any existing singleton is destroyed
    StateMachine._instance = None


@pytest.fixture
def contract():
    # it's a different contract than in details below
    return ibi.Contract(
        secType="FUT",
        conId=620730920,
        symbol="NQ",
        lastTradeDateOrContractMonth="20240621",
        multiplier="20",
        exchange="CME",
        currency="USD",
        localSymbol="NQM4",
        tradingClass="NQ",
    )


@pytest.fixture
def details():
    # Note: contains also ibi.Contract
    return ibi.ContractDetails(
        contract=ibi.Contract(
            secType="CONTFUT",
            conId=603558814,
            symbol="NQ",
            lastTradeDateOrContractMonth="20240315",
            multiplier="20",
            exchange="CME",
            currency="USD",
            localSymbol="NQH4",
            tradingClass="NQ",
        ),
        marketName="NQ",
        minTick=0.25,
        orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
        validExchanges="CME,QBALGO",
        priceMagnifier=1,
        underConId=11004958,
        longName="E-mini NASDAQ 100 ",
        contractMonth="202403",
        industry="",
        category="",
        subcategory="",
        timeZoneId="US/Central",
        tradingHours="20240303:1700-20240304:1600;20240304:1700-20240305:1600;20240305:1700-20240306:1600;20240306:1700-20240307:1600;20240307:1700-20240308:1600",
        liquidHours="20240304:0830-20240304:1600;20240305:0830-20240305:1600;20240306:0830-20240306:1600;20240307:0830-20240307:1600;20240308:0830-20240308:1600",
        evRule="",
        evMultiplier=0,
        mdSizeMultiplier=1,
        aggGroup=2147483647,
        underSymbol="NQ",
        underSecType="IND",
        marketRuleIds="67,67",
        secIdList=[],
        realExpirationDate="20240315",
        lastTradeTime="08:30:00",
        stockType="",
        minSize=1.0,
        sizeIncrement=1.0,
        suggestedSizeIncrement=1.0,
        cusip="",
        ratings="",
        descAppend="",
        bondType="",
        couponType="",
        callable=False,
        putable=False,
        coupon=0,
        convertible=False,
        maturity="",
        issueDate="",
        nextOptionDate="",
        nextOptionType="",
        nextOptionPartial=False,
        notes="",
    )


@pytest.fixture
def Atom(state_machine, details):
    sm = state_machine
    BaseAtom.set_init_data(ibi.IB(), sm)
    BaseAtom.contract_details[details.contract] = details
    return BaseAtom


@pytest.fixture
def controller(Atom):
    return Controller(Trader(Atom.ib))


@pytest.fixture
def trade():
    """
    This is an example trade as actually produced by ib_insync, it can
    be passed to objects that require a trade.
    """
    return ibi.Trade(
        contract=ibi.Future(
            conId=620731015,
            symbol="ES",
            lastTradeDateOrContractMonth="20250620",
            multiplier="50",
            exchange="CME",
            currency="USD",
            localSymbol="ESM5",
            tradingClass="ES",
        ),
        order=ibi.Order(
            orderId=55308,
            permId=1761343997,
            action="BUY",
            totalQuantity=1.0,
            orderType="MKT",
            lmtPrice=5740.75,
            auxPrice=0.0,
            tif="Day",
            algoStrategy="Adaptive",
            algoParams=[ibi.TagValue(tag="adaptivePriority", value="Normal")],
        ),
        orderStatus=ibi.OrderStatus(
            orderId=55308,
            status="Filled",
            filled=1.0,
            remaining=0.0,
            avgFillPrice=5740.5,
            permId=1761343997,
            parentId=0,
            lastFillPrice=5740.5,
            clientId=0,
            whyHeld="",
            mktCapPrice=0.0,
        ),
        fills=[
            ibi.Fill(
                contract=ibi.Future(
                    conId=620731015,
                    symbol="ES",
                    lastTradeDateOrContractMonth="20250620",
                    multiplier="50",
                    exchange="CME",
                    currency="USD",
                    localSymbol="ESM5",
                    tradingClass="ES",
                ),
                execution=ibi.Execution(
                    execId="0000e1a7.67dbf24e.01.01",
                    time=datetime.datetime(
                        2025, 3, 20, 16, 6, 5, tzinfo=datetime.timezone.utc
                    ),
                    acctNumber="DU3598515",
                    exchange="CME",
                    side="BOT",
                    shares=1.0,
                    price=5740.5,
                    permId=1761343997,
                    clientId=0,
                    orderId=55308,
                    liquidation=0,
                    cumQty=1.0,
                    avgPrice=5740.5,
                    orderRef="",
                    evRule="",
                    evMultiplier=0.0,
                    modelCode="",
                    lastLiquidity=1,
                ),
                commissionReport=ibi.CommissionReport(
                    execId="0000e1a7.67dbf24e.01.01",
                    commission=2.25,
                    currency="USD",
                    realizedPNL=0.0,
                    yield_=0.0,
                    yieldRedemptionDate=0,
                ),
                time=datetime.datetime(
                    2025, 3, 20, 16, 6, 6, 104085, tzinfo=datetime.timezone.utc
                ),
            )
        ],
        log=[
            ibi.TradeLogEntry(
                time=datetime.datetime(
                    2025, 3, 20, 16, 6, 5, 387455, tzinfo=datetime.timezone.utc
                ),
                status="PendingSubmit",
                message="",
                errorCode=0,
            ),
            ibi.TradeLogEntry(
                time=datetime.datetime(
                    2025, 3, 20, 16, 6, 6, 104085, tzinfo=datetime.timezone.utc
                ),
                status="Submitted",
                message="",
                errorCode=0,
            ),
            ibi.TradeLogEntry(
                time=datetime.datetime(
                    2025, 3, 20, 16, 6, 6, 104085, tzinfo=datetime.timezone.utc
                ),
                status="Submitted",
                message="Fill 1.0@5740.5",
                errorCode=0,
            ),
            ibi.TradeLogEntry(
                time=datetime.datetime(
                    2025, 3, 20, 16, 6, 6, 104085, tzinfo=datetime.timezone.utc
                ),
                status="Filled",
                message="",
                errorCode=0,
            ),
        ],
        advancedError="",
    )


@pytest.fixture
def details_chain():
    # Future(symbol='ES', exchange='CME') as of 20.06.2025
    return [
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=637533641,
                symbol="ES",
                lastTradeDateOrContractMonth="20250919",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU5",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202509",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20250919",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=495512563,
                symbol="ES",
                lastTradeDateOrContractMonth="20251219",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESZ5",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202512",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20251219",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=515416632,
                symbol="ES",
                lastTradeDateOrContractMonth="20261218",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESZ6",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202612",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20261218",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=586139767,
                symbol="ES",
                lastTradeDateOrContractMonth="20271217",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESZ7",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202712",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20271217",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=620731015,
                symbol="ES",
                lastTradeDateOrContractMonth="20250620",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM5",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202506",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:0830;20250621:CLOSED;20250622:CLOSED",
            liquidHours="20250618:1700-20250619:1200;20250620:CLOSED;20250621:CLOSED;20250622:CLOSED",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20250620",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180661,
                symbol="ES",
                lastTradeDateOrContractMonth="20270617",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM7",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202706",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20270617",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180666,
                symbol="ES",
                lastTradeDateOrContractMonth="20280317",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESH8",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202803",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20280317",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180671,
                symbol="ES",
                lastTradeDateOrContractMonth="20260918",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU6",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202609",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20260918",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180675,
                symbol="ES",
                lastTradeDateOrContractMonth="20280915",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU8",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202809",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20280915",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180678,
                symbol="ES",
                lastTradeDateOrContractMonth="20260618",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM6",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202606",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20260618",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180681,
                symbol="ES",
                lastTradeDateOrContractMonth="20270917",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU7",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202709",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20270917",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180684,
                symbol="ES",
                lastTradeDateOrContractMonth="20270319",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESH7",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202703",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20270319",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180690,
                symbol="ES",
                lastTradeDateOrContractMonth="20280616",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM8",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202806",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20280616",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=649180695,
                symbol="ES",
                lastTradeDateOrContractMonth="20260320",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESH6",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202603",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20260320",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=654503299,
                symbol="ES",
                lastTradeDateOrContractMonth="20281215",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESZ8",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202812",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20281215",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=672387437,
                symbol="ES",
                lastTradeDateOrContractMonth="20290316",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESH9",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202903",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20290316",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=691171642,
                symbol="ES",
                lastTradeDateOrContractMonth="20290615",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM9",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202906",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20290615",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=711280049,
                symbol="ES",
                lastTradeDateOrContractMonth="20290921",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU9",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202909",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20290921",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=730283071,
                symbol="ES",
                lastTradeDateOrContractMonth="20291221",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESZ9",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202912",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20291221",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=750150169,
                symbol="ES",
                lastTradeDateOrContractMonth="20300315",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESH0",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="203003",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20300315",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=770561177,
                symbol="ES",
                lastTradeDateOrContractMonth="20300621",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESM0",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="203006",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20300621",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
        ContractDetails(
            contract=Contract(
                secType="FUT",
                conId=793356200,
                symbol="ES",
                lastTradeDateOrContractMonth="20300920",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU0",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="203009",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20300920",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        ),
    ]


@pytest.fixture
def contfuture_details_chain():
    return [
        ContractDetails(
            contract=Contract(
                secType="CONTFUT",
                conId=637533641,
                symbol="ES",
                lastTradeDateOrContractMonth="20250919",
                multiplier="50",
                exchange="CME",
                currency="USD",
                localSymbol="ESU5",
                tradingClass="ES",
            ),
            marketName="ES",
            minTick=0.25,
            orderTypes="ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DAY,DEACT,DEACTDIS,DEACTEOD,GAT,GTC,GTD,GTT,HID,ICE,IOC,LIT,LMT,LTH,MIT,MKT,MTL,NGCOMB,NONALGO,OCA,PEGBENCH,SCALE,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF",
            validExchanges="CME,QBALGO",
            priceMagnifier=1,
            underConId=11004968,
            longName="E-mini S&P 500",
            contractMonth="202509",
            industry="",
            category="",
            subcategory="",
            timeZoneId="US/Central",
            tradingHours="20250618:1700-20250619:1200;20250619:1700-20250620:1600;20250621:CLOSED;20250622:1700-20250623:1600;20250623:1700-20250624:1600;20250624:1700-20250625:1600",
            liquidHours="20250618:1700-20250619:1200;20250620:0830-20250620:1600;20250621:CLOSED;20250622:CLOSED;20250623:0830-20250623:1600;20250624:0830-20250624:1600;20250624:1700-20250625:1600",
            evRule="",
            evMultiplier=0,
            mdSizeMultiplier=1,
            aggGroup=2147483647,
            underSymbol="ES",
            underSecType="IND",
            marketRuleIds="67,67",
            secIdList=[],
            realExpirationDate="20250919",
            lastTradeTime="08:30:00",
            stockType="",
            minSize=1.0,
            sizeIncrement=1.0,
            suggestedSizeIncrement=1.0,
            cusip="",
            ratings="",
            descAppend="",
            bondType="",
            couponType="",
            callable=False,
            putable=False,
            coupon=0,
            convertible=False,
            maturity="",
            issueDate="",
            nextOptionDate="",
            nextOptionType="",
            nextOptionPartial=False,
            notes="",
        )
    ]


@pytest.fixture
def Streamer():
    yield ActualStreamer
    ActualStreamer.instances = []
